filebeat.inputs:
    - type: docker
    #   combine_partial: true
      containers:
        path: "/var/lib/docker/containers"
        stream: "all"
        ids:
          - "*"
      ignore_older: 10m

filebeat.config:
    modules:
      path: ${path.config}/modules.d/*.yml
      reload.enabled: false
  
filebeat.autodiscover:
    providers:
        - type: docker
          hints.enabled: true

processors:
# decode the log field (sub JSON document) if JSON encoded, then maps it's fields to elasticsearch fields
- decode_json_fields:
    fields: ["log", "message"]
    target: ""
    # overwrite existing target elasticsearch fields while decoding json fields    
    overwrite_keys: true
- add_docker_metadata:
    host: "unix:///var/run/docker.sock"

output.elasticsearch:
    hosts: '${ELASTICSEARCH_HOSTS:elasticsearch:9200}'
    indices:
        - index: "filebeat-%{[agent.version]}-%{+yyyy.MM.dd}"
    username: '${ELASTICSEARCH_USERNAME:}'
    password: '${ELASTICSEARCH_PASSWORD:}'
